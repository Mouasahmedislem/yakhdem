<!DOCTYPE html>
<html lang="en">

<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<!-- Meta Pixel with Advanced Matching and SHA-256 hashing -->
<!-- Meta Pixel Code -->
<!-- Meta Pixel Code -->
<% if (process.env.FB_PIXEL_ID) { %>
<!-- Facebook Pixel Code -->


<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');

// Create config object dynamically
var pixelConfig = {};

// Only add parameters that have values
<% if (user && user.email) { %> pixelConfig.em = '<%= user.email %>'; <% } %>
<% if (user && user.firstName) { %> pixelConfig.fn = '<%= user.firstName %>'; <% } %>
<% if (user && user.lastName) { %> pixelConfig.ln = '<%= user.lastName %>'; <% } %>
<% if (user && user.numero) { %> pixelConfig.ph = '<%= user.numero %>'; <% } %>
<% if (user && user._id) { %> pixelConfig.external_id = '<%= user._id %>'; <% } %>

// Initialize with dynamic config
fbq('init', '<%= process.env.FB_PIXEL_ID %>', pixelConfig);
fbq('track', 'PageView');
</script>
<noscript>
  <img height="1" width="1" style="display:none"
       src="https://www.facebook.com/tr?id=633564199312760&ev=PageView&noscript=1"/>
</noscript>
<!-- End Facebook Pixel Code -->
<% } %>

<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "t8r0mi7k1l");
</script>

  <meta name="facebook-domain-verification" content="plfly5a8dktgdy17nvv2h8zsrpc9g5" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Paintello | Checkout</title> 
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/site.webmanifest">  
  <meta name="theme-color" content="#ffffff">  <link href='https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css' rel='stylesheet'>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="../../css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="../../css/mdb.min.css" rel="stylesheet">
 <style>
     
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #fefefe;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
    }
    .carousel {
      position: relative;
      overflow: hidden;
      width: 100%;
      border-radius: 12px;
    }
    .carousel-images {
      display: flex;
      transition: transform 0.5s ease-in-out;
    }
    .carousel-images img {
      width: 100%;
      flex-shrink: 0;
    }
    .carousel-buttons {
      position: absolute;
      top: 50%;
      width: 100%;
      display: flex;
      justify-content: space-between;
      transform: translateY(-50%);
    }
    .carousel-buttons button {
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      padding: 0 12px;
    }
    .price {
      color: #f4791f;
      font-size: 1.5rem;
      margin: 10px 0;
    }
    .btn {
      display: inline-block;
      background: #f4791f;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      text-decoration: none;
      font-size: 1rem;
      margin-top: 20px;
      cursor: pointer;
    }
    .btn:hover {
      background: #c85f0d;
    }
    .quantity {
      margin-top: 20px;
    }
    .quantity label {
      margin-right: 10px;
      font-weight: bold;
    }
    .quantity input {
      width: 60px;
      padding: 5px;
      font-size: 1rem;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .cart-link {
      display: block;
      margin-top: 30px;
      text-align: center;
    }
    .cart-link a {
      color: #f4791f;
      text-decoration: none;
      font-weight: bold;
    }
    .cart-link a:hover {
      text-decoration: underline;
    }
    .checkout-form {
      margin-top: 40px;
      border-top: 1px solid #ddd;
      padding-top: 20px;
    }
    .checkout-form label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .checkout-form input, .checkout-form select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
  </style>

</head>


<body>
  <!-- Main Navigation -->
  <header>
<script type="text/javascript" src="javascripts/checkout.js"></script>
<script type="text/javascript" src="https://js.stripe.com/v2/"></script>




    
  <!-- Your fixed logo here -->
  <div id="checkout-logo" style="text-align: center; margin-top: 20px;">
    <a href="/">
      <img src="/favicon/android-chrome-192x192.png" alt="Paintello Logo" style="max-height: 80px;">
    </a>
<a href="/">
      <img src="/img/logo.png" alt="Paintello Logo" style="max-height: 80px;">
    </a>
  </div>

                 
                  <!-- Body -->

                   <div class="checkout-form">
      <h2>Checkout (Algeria Only)</h2>
      <form action="/checkout" method="POST">
        <label for="fullname">Full Name</label>
        <input type="text" id="name" name="name" required>

        <label for="phone">Phone Number</label>
        <input type="tel" name="numero" id="numero" pattern="0[5-7][0-9]{8}" placeholder="e.g. 0551234567" required>
        <label for="country">Country</label>
        <input type="text" id="country" name="country" value="Algeria" readonly>
        <label for="city">Wilaya</label>
        <select id="city" name="city" required>
  <option value="">select your wilaya</option>
  <option value="adrar">adrar - 01</option>
  <option value="chlef">chlef - 02</option>
  <option value="laghouat">laghouat - 03</option>
  <option value="oum el bouaghi">oum el bouaghi - 04</option>
  <option value="batna">batna - 05</option>
  <option value="bejaia">bejaia - 06</option>
  <option value="biskra">biskra - 07</option>
  <option value="bechar">bechar - 08</option>
  <option value="blida">blida - 09</option>
  <option value="bouira">bouira - 10</option>
  <option value="tamanrasset">tamanrasset - 11</option>
  <option value="tebessa">tebessa - 12</option>
  <option value="tlemcen">tlemcen - 13</option>
  <option value="tiaret">tiaret - 14</option>
  <option value="tizi ouzou">tizi ouzou - 15</option>
  <option value="algiers">alger - 16</option>
  <option value="djelfa">djelfa - 17</option>
  <option value="jijel">jijel - 18</option>
  <option value="setif">setif - 19</option>
  <option value="saida">saida - 20</option>
  <option value="skikda">skikda - 21</option>
  <option value="sidi belabbes">sidi bel abb√®s - 22</option>
  <option value="guelma">guelma - 23</option>
  <option value="constantine">constantine - 24</option>
  <option value="medea">medea - 25</option>
  <option value="mostaganem">mostaganem - 26</option>
  <option value="m'sila">m'sila - 27</option>
  <option value="mascara">mascara - 28</option>
  <option value="ouargla">ouargla - 29</option>
  <option value="oran">oran - 31</option>
  <option value="el bayadh">el bayadh - 32</option>
  <option value="bordj bou arreridj">bordj bou arreridj - 34</option>
  <option value="boumerdes">boumerdes - 35</option>
  <option value="el taref">el taref - 36</option>
  <option value="tindouf">tindouf - 37</option>
  <option value="tissemsilt">tissemsilt - 38</option>
  <option value="el oued">el oued - 39</option>
  <option value="khenchela">khenchela - 40</option>
  <option value="souk ahras">souk ahras - 41</option>
  <option value="tipaza">tipaza - 42</option>
  <option value="mila">mila - 43</option>
  <option value="ain defla">ain defla - 44</option>
  <option value="naama">naama - 45</option>
  <option value="ain temouchent">ain temouchent - 46</option>
  <option value="ghardaia">ghardaia - 47</option>
  <option value="relizane">relizane - 48</option>
  <option value="el m'ghair">el m'ghair - 49</option>
  <option value="el menia">el menia - 50</option>
  <option value="ouled djellal">ouled djellal - 51</option>
  <option value="bordj badji mokhtar">bordj badji mokhtar - 52</option>
  <option value="beni abbes">beni abbes - 53</option>
  <option value="timimoun">timimoun - 54</option>
  <option value="touggourt">touggourt - 55</option>
  <option value="djanet">djanet - 56</option>
  <option value="in salah">in salah - 57</option>
  <option value="in guezzam">in guezzam - 58</option>
</select>

        <label for="address">Full Address</label>
        <input type="text" name="address" id="address" required>
        <input type="hidden" id="shippingFee" name="shippingFee">
        <input type="hidden" id="deliveryDelay" name="deliveryDelay">
        <input type="hidden" id="totalPriceFinal" name="totalPriceFinal">

        <button type="submit" class="btn btn-pink btn-rounded">Place Order</button>
      </form>
    </div>
  </div>
                
                    <hr>
                    
                <div class="cart-link">
      <a href="/">Go to Shop</a>
    </div>
                  


  <script>
  const FREE_SHIPPING_THRESHOLD = 5000; // DA
  const basePrice = <%= totalPrice %>; // coming from your server

  // Full wilaya list with delivery times and estimated shipping fees (example data)
  const shippingData = {
    "adrar": { fee: 800, delay: "4‚Äì6 days" },
    "chlef": { fee: 600, delay: "3‚Äì5 days" },
    "laghouat": { fee: 750, delay: "4‚Äì6 days" },
    "oum el bouaghi": { fee: 600, delay: "3‚Äì5 days" },
    "batna": { fee: 600, delay: "3‚Äì5 days" },
    "bejaia": { fee: 500, delay: "2‚Äì4 days" },
    "biskra": { fee: 700, delay: "3‚Äì5 days" },
    "bechar": { fee: 850, delay: "4‚Äì6 days" },
    "blida": { fee: 300, delay: "1‚Äì2 days" },
    "bouira": { fee: 500, delay: "2‚Äì3 days" },
    "tamanrasset": { fee: 1000, delay: "5‚Äì8 days" },
    "tebessa": { fee: 700, delay: "3‚Äì5 days" },
    "tlemcan": { fee: 500, delay: "2‚Äì3 days" },
    "tiaret": { fee: 550, delay: "3‚Äì4 days" },
    "tizi ouzou": { fee: 400, delay: "2‚Äì3 days" },
    "djelfa": { fee: 600, delay: "3‚Äì4 days" },
    "jijel": { fee: 450, delay: "2‚Äì3 days" },
    "setif": { fee: 500, delay: "2‚Äì3 days" },
    "saida": { fee: 600, delay: "3‚Äì4 days" },
    "skikda": { fee: 500, delay: "2‚Äì3 days" },
    "sidi belabbas": { fee: 550, delay: "3‚Äì4 days" },
    "geulma": { fee: 600, delay: "3‚Äì4 days" },
    "medea": { fee: 400, delay: "2‚Äì3 days" },
    "mostaganem": { fee: 450, delay: "2‚Äì3 days" },
    "m'sila": { fee: 500, delay: "2‚Äì3 days" },
    "mascara": { fee: 500, delay: "2‚Äì3 days" },
    "ouergla": { fee: 700, delay: "4‚Äì6 days" },
    "el bayadh": { fee: 750, delay: "4‚Äì6 days" },
    "borj bou arreridj": { fee: 500, delay: "2‚Äì3 days" },
    "boumerdas": { fee: 350, delay: "1‚Äì2 days" },
    "el taref": { fee: 700, delay: "3‚Äì5 days" },
    "tissemsil": { fee: 550, delay: "3‚Äì4 days" },
    "el oued": { fee: 750, delay: "4‚Äì6 days" },
    "khenchla": { fee: 650, delay: "3‚Äì5 days" },
    "souk ahras": { fee: 600, delay: "3‚Äì4 days" },
    "tipaza": { fee: 300, delay: "1‚Äì2 days" },
    "mila": { fee: 500, delay: "2‚Äì3 days" },
    "ain defla": { fee: 400, delay: "2‚Äì3 days" },
    "naama": { fee: 800, delay: "4‚Äì6 days" },
    "ain temouchent": { fee: 550, delay: "3‚Äì4 days" },
    "ghardaia": { fee: 700, delay: "4‚Äì6 days" },
    "ghilezan": { fee: 500, delay: "2‚Äì3 days" },
    "el m'ghaiar": { fee: 800, delay: "4‚Äì6 days" },
    "el menia": { fee: 900, delay: "5‚Äì7 days" },
    "ouled djellal": { fee: 700, delay: "4‚Äì6 days" },
    "beni abbas": { fee: 900, delay: "5‚Äì7 days" },
    "timimoun": { fee: 950, delay: "5‚Äì7 days" },
    "touggourt": { fee: 850, delay: "4‚Äì6 days" },
    "in saleh": { fee: 1000, delay: "6‚Äì8 days" },
    "in guezzam": { fee: 1200, delay: "6‚Äì9 days" },
    "algiers": { fee: 300, delay: "1‚Äì2 days" },
    "oran": { fee: 400, delay: "2‚Äì3 days" },
    "constantine": { fee: 500, delay: "2‚Äì3 days" },
    "annaba": { fee: 500, delay: "2‚Äì3 days" }
  };

citySelect.addEventListener('change', () => {
  const selected = citySelect.value.trim().toLowerCase(); // match lowercase keys
  const data = shippingData[selected] || { fee: 1000, delay: "3‚Äì5 days" };

  let shippingFee = data.fee;
  const deliveryTime = data.delay;

  if (basePrice >= FREE_SHIPPING_THRESHOLD) {
    shippingFee = 0;
  }

  const finalPrice = basePrice + shippingFee;

  // ‚úÖ Update visible info box
  infoBox.innerHTML = `
    üöö <strong>Shipping Fee:</strong> ${shippingFee} DA<br>
    ‚è± <strong>Estimated Delivery:</strong> ${deliveryTime}<br>
    üí∞ <strong>Total Including Shipping:</strong> ${finalPrice} DA
  `;

  // ‚úÖ Update hidden form fields
  document.getElementById('shippingFee').value = shippingFee;
  document.getElementById('deliveryDelay').value = deliveryTime;
  document.getElementById('totalPriceFinal').value = finalPrice;
});

</script>





  <!-- Main Navigation -->
  <%- include ("../partials/footer") %>.
 
